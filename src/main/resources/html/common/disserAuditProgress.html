<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>提交论文审核</title>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.css"/>
</head>
<body>
<div class="container">
    <h3>审核进度</h3>
    <p id="status" class="mt-3 text-info"> 未提交审核</p>
    <div class="progress">
        <div id="progress" class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="25"
             aria-valuemin="0" aria-valuemax="100"></div>
    </div>
    <div id="down">
        <h5 class="mt-5">指导老师意见</h5>
        <p id="advice" class="text-warning">暂无意见</p>
        <div id="audit-wrap" class="mt-5">
            <h5>提交新的审核</h5>
            <h5 class="text-danger text-center">支持pdf文档，最大2M</h5>
            <form action="">
                <div class="input-group row">
                    <input type="file" class="form-control col-4" id="file" accept=".pdf">
                    <input type="hidden" value="1" id="step">
                    <button type="button" class="btn btn-success col-2" onclick="save()">提交审核</button>
                </div>
            </form>
        </div>
    </div>



</div>
<script src="/js/axios.min.js"></script>
<script src="/bootstrap/js/bootstrap.bundle.js"></script>
<script type="module">
    import statusList from '/js/statusList.js'
    function init() {
        let status = document.getElementById('status')
        let progress = document.getElementById('progress')
        let advice = document.getElementById('advice')
        axios('/student/audit')
            .then(resp => {
                const data = resp.data.data
                status.innerHTML = statusList[data.status]
                if (data.status > 1 && data.status < 5) {
                    progress.style.width = '25%'
                } else if (data.status > 4 && data.status < 10) {
                    progress.style.width = '50%'
                } else if (data.status == 10) {
                    progress.style.width = '100%'
                    document.getElementById('down').className = 'd-none'
                }else if(data.status==0) {
                    document.getElementById('down').className = 'd-none'
                }
                if (data.advice != '') advice.innerHTML = data.advice
            })
    }

    init()

    window.save = function () {
        let param = new FormData()
        const file = document.getElementById('file')
        if (file.files.length === 0) {
            alert("未选择文件");
            return;
        }
        if (file.files[0].size > 2048000) {
            alert("文件大小超过限制");
            return;
        }
        param.append('file', file.files[0])
        axios.post('/student/audit', param)
            .then(resp => {
                if (resp.data.msg == 'ok') {
                    alert(" 提交成功！")
                    location.reload()
                }
            })


    }
</script>
</body>
</html>